services:
  app:
    image: node:22.8.0
    ports:
      - ${PORT}:${PORT}
    volumes:
      - ./:/usr/src/app
    working_dir: /usr/src/app

  mysql:
    image: mysql:8.4
    command: --port=${MYSQL_PORT}
    ports:
      - "${MYSQL_PORT}:${MYSQL_PORT}"
    environment:
      MYSQL_DATABASE: ${MYSQL_DB}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${MYSQL_PASSWORD}
    restart: always

  mailhog:
    image: mailhog/mailhog
    ports:
      - ${EMAIL_SMTP_PORT}:${EMAIL_SMTP_PORT}  # SMTP port for sending emails
      - ${EMAIL_HTTP_PORT}:${EMAIL_HTTP_PORT}  # HTTP interface for viewing emails
    environment:
      - MH_STORAGE=memory
      - MH_SMTP_AUTH=true  # Enable SMTP authentication
      - MH_SMTP_USER=${EMAIL_USER}  # Set the SMTP username
      - MH_SMTP_PASSWORD=${EMAIL_PASSWORD}

  redis:
    image: redis:7.4
    ports:
      - ${REDIS_PORT}:${REDIS_PORT}
    command: >
      redis-server
      --requirepass ${REDIS_PASSWORD}
      --port ${REDIS_PORT}
      --maxmemory 256mb
    restart: always

#   RUSTFS DOCKER CONTAINER. POOR SUPPORT OF AWS PROGRAMMATIC COMMANDS.
#   rustfs:
#    image: rustfs/rustfs:latest
#    ports:
#      - "${S3_PORT}:${S3_PORT}"
#      - "${S3_INTERFACE_PORT}:${S3_INTERFACE_PORT}"
#    environment:
#      RUSTFS_ADDRESS: ":${S3_PORT}"
#      RUSTFS_CONSOLE_ADDRESS: ":${S3_INTERFACE_PORT}"
#      RUSTFS_CONSOLE_ENABLE: "true"
#      RUSTFS_ACCESS_KEY: ${S3_ACCESS_KEY_ID}
#      RUSTFS_SECRET_KEY: ${S3_SECRET_ACCESS_KEY}

# TODO: Change container name
#  LOCALSTACK CONTAINER
  rustfs:
    image: localstack/localstack:latest
    ports:
      - "${S3_PORT}:${S3_PORT}"
    environment:
      SERVICES: s3
      GATEWAY_LISTEN: "0.0.0.0:${S3_PORT}"
      AWS_ACCESS_KEY_ID: ${S3_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${S3_SECRET_ACCESS_KEY}
      DEBUG: "1"
      DATA_DIR: /data
